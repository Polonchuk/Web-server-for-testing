# webserver_influx.py 

Это простой сервер, который может быть использован для тестирования возможностей машины, на которой он развернут. Сервер написан "наивно" :), и он сам и база данных временных рядов InfluxDB, в которую он пишет статистику о количестве обращений, по умолчанию должны быть запущены на одной машине.

## Подготовка сервера к запуску и запуск сервера

Сервер написан с использованием Python 3.9.2. С учетом наличия в коде f-строк, Python ранее версии 3.6 для запуска программы не подойдет.
Предполагается, что на той же машине, где запускается сервер, развернута InfluxDB. Я установил InfluxDB версии 1.8.9. При этом конфигурация базы данных оставлена по умолчанию:
* host: 'localhost'
* port: 8086

Перед запуском также необходимо установить дополнительные пакеты:
```
    pip install -r requirements.txt
```
Для запуска сервера:
* запустите файл *influxd.exe* или *influxd -config influxdb.conf* для старта базы данных;
* запустите influx-клиента (*influx.exe* или *influx*) и создайте в нем базу данных и пользователя при помощи следующих команд:
```
    create database math_server
    create user math_server with password 'math_server1'
```
Название базы, пользователь и пароль в коде заданы жестко.

* запустите *webserver_influx.py*, используя Python.

## Запросы к серверу

Сервер принимает как GET, так и POST запросы на порте *8008*.
* В GET-запросах он ищет числовые значения аргументов в "query string", складывает их и возвращает в ответ строку **"Sum: <*сумма присланных аргументов*>"**. В процессе обработки числовые значения приводятся к формату *float*. Если в запросе нет аргументов с числовыми значениями, будет возвращена строка **"Sum: 0"**.
* POST запросы обрабатываются только при *Content-Type* вида *application/json*. В противном случае сервер вернет статус ответа **(400)** и предупредительную фразу *"Please, ensure the content type of your request is "application/json"."*.
Из тела POST-запроса сервер берет числовые значения величин (*values*) из передаваемого словаря, суммирует и возвращает "ответ" так же, как и в случае GET-запроса.

Отсылать запросы можно любым доступным вам способом. Например, ваш запрос может выглядеть вот так:
```
    curl -G -d "a=3" -d "b=3" http://localhost:8008
```

## Статистика в базу данных

При запуске сервера, сервер раз в минуту отсылает количество обращений к нему за последнюю минуту в базу данных временных рядов InfluxDB.
Структура отсылаемых данных задана следующим образом:
```
    report = [{
        "measurement": "requests",
        "tags": {
            "request": "GETs_per_minute" 
            },
        "time": <время отсылки статистики>,
        "fields": {
            "requests_number": <количество обращений за последнюю минуту>,
        }
    }]
```
Увидеть собранные данные можно при помощи influx-клиента. Запустите его и исполните следующие команды:
```
	use math_server
	SELECT * from requests
```
Вы увидите построчно данные за каждую минуту работы сервера.